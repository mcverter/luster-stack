<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Creating an AMI from an Instance Store-Backed
         			Instance - Amazon Elastic Compute Cloud
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <link rel="home" href="#top" />
      <link rel="up" href="creating-an-ami-instance-store.html" title="Creating an Instance Store-Backed Linux AMI" />
      <link rel="prev" href="set-up-ami-tools.html" title="Setting Up the AMI Tools" />
      <link rel="next" href="Using_ConvertingS3toEBS.html" title="Converting your Instance Store-Backed AMI to an&#xA;&#x9;&#x9;&#x9;Amazon EBS-Backed AMI" />
      <meta name="description" content="Create an instance store-backed AMI from an Amazon Linux or Ubuntu instance." />
      <meta name="keywords" content="EC2,Amazon EC2,EC2 instance,instance,VM,virtual machine" />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="Amazon Elastic Compute Cloud" />
      <meta name="guide" content="User Guide for Linux Instances" />
      <meta name="guide-locale" content="en_us" />
      <link rel="icon" type="image/ico" href="/images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="/images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/create-instance-store-ami.html" />
      <link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css" />
      <link rel="stylesheet" type="text/css" href="/font/css/font-awesome.min.css" />
      <link rel="stylesheet" type="text/css" href="/css/google-font.css" />
      <link id="code-style" rel="stylesheet" type="text/css" href="/css/code/light.css" />
      <link rel="stylesheet" type="text/css" href="/css/jquery-ui.theme.css" />
      <link rel="stylesheet" type="text/css" href="/css/colorbox.css" />
      <link rel="stylesheet" type="text/css" href="/css/awsdocs.css?v=20170615" /><script type="text/javascript" src="/js/highlight.pack.js"></script><script type="text/javascript" src="/js/jquery.min.js"></script><script type="text/javascript" src="/js/jquery-ui.min.js"></script><script type="text/javascript" src="/js/handlebars.js"></script><script type="text/javascript" src="/js/jquery.colorbox.js"></script><script type="text/javascript" src="/js/awsdocs.min.js?v=20170615"></script></head>
   <body id="top">
      <div xmlns:db="http://docbook.org/ns/docbook" id="aws-nav" class="aws-nav-header">
         <div class="aws-nav-header-left">
            <div id="aws-nav-flyout-trigger" class="aws-nav-flyout-trigger"><i class="fa fa-bars fa-2x"></i></div>
            <div class="aws-nav-logo">
               <!--aws_logo_105x39.png--><a href="http://aws.amazon.com"><img src="/images/aws_logo_105x39.png" alt="Amazon Web Services" /></a></div>
         </div>
         <div id="aws-nav-header-right" class="aws-nav-header-right">
            <div class="aws-nav-cta-button-outer"><a id="aws-nav-cta-button" class="aws-nav-button" href="https://console.aws.amazon.com/console/home">Sign In to the Console</a></div>
            <div class="aws-nav-popover-trigger" data-dropdown="aws-nav-dropdown-lang"><select id="languageSelection" onchange="SelectLanguage()">
                  <option value="/de_de/AWSEC2/latest/UserGuide/create-instance-store-ami.html">Deutsch</option>
                  <option value="/en_us/AWSEC2/latest/UserGuide/create-instance-store-ami.html" selected="selected">English</option>
                  <option value="/es_es/AWSEC2/latest/UserGuide/create-instance-store-ami.html">Español</option>
                  <option value="/fr_fr/AWSEC2/latest/UserGuide/create-instance-store-ami.html">Français</option>
                  <option value="/it_it/AWSEC2/latest/UserGuide/create-instance-store-ami.html">Italiano</option>
                  <option value="/ja_jp/AWSEC2/latest/UserGuide/create-instance-store-ami.html">日本語</option>
                  <option value="/ko_kr/AWSEC2/latest/UserGuide/create-instance-store-ami.html">한국어</option>
                  <option value="/pt_br/AWSEC2/latest/UserGuide/create-instance-store-ami.html">Português</option>
                  <option value="/zh_cn/AWSEC2/latest/UserGuide/create-instance-store-ami.html">中文 (简体)</option>
                  <option value="/zh_tw/AWSEC2/latest/UserGuide/create-instance-store-ami.html">中文 (繁體)</option></select></div><a class="btn btn-rss-link" id="rss-link-top" target="_blank" href="amazon-ec2-release-notes.rss" title="View RSS Feed"></a><a class="btn btn-kindle-link" id="kindle-link-top" target="_blank" href="http://www.amazon.com/dp/B076452RSZ" title="Open Kindle"></a><a class="btn btn-pdf-link" id="pdf-link-top" href="ec2-ug.pdf#create-instance-store-ami" target="_blank" title="Open PDF"></a><a class="btn btn-github-link" id="github-link-top" href="https://github.com/awsdocs/amazon-ec2-user-guide/tree/master/doc_source/create-instance-store-ami.md" target="_blank" title="Edit on GitHub"></a><div id="aws-nav-quicklinks-separator" class="aws-nav-quicklinks-separator">
               <div class="aws-nav-left"></div>
               <div class="aws-nav-right"></div>
            </div>
         </div>
         <div xmlns:l="http://docbook.sourceforge.net/xmlns/l10n/1.0" id="topnav-flyout-menu-container">
            <ul id="topnav-flyout-menu"><script id="flyout-item-template" type="text/x-handlebars-template">
                    {{#flyoutList}}

                        {{#if topTarget}}
                            <li class="awsdocs-flyout-link-wrapper"><a href="{{topTarget}}">{{listItem}}</a></li>
                        {{else}}
                            <li>{{listItem}}
                                {{#if subList}}
                                <ul>
                                    {{#subList}}
                                    <li class="awsdocs-flyout-link-wrapper"><a href="{{target}}">{{text}}</a></li>
                                    {{/subList}}
                                </ul>
                                {{/if}}
                            </li>
                        {{/if}}

                    {{/flyoutList}}
                </script></ul>
            <div id="topnav-flyout-menu-spacer"></div>
         </div>
      </div>
      <div id="content-container">
         <div id="left-column">
            <div id="left-col-header">
               <div xmlns:db="http://docbook.org/ns/docbook" id="left-col-top-content">
                  <div id="service-name">Amazon Elastic Compute Cloud </div>
                  <div id="search"><i id="search-icon" class="fa fa-search fa-2x"></i></div>
                  <div id="guide-info">User Guide for Linux Instances
                     <div id="content-button"><i id="toggle-contents" class="fa fa-bars"></i></div>
                  </div>
               </div>
               <form id="finegrainedSearch" method="get" onsubmit="return searchFormSubmit(this);" action="/search/doc-search.html">
                  <div id="search-form"><select id="search-select" name="searchPath">
                        <option value="all">Entire Site</option>
                        <option value="AWSMarketplace">AMIs from AWS Marketplace</option>
                        <option value="amis">AMIs from All Sources</option>
                        <option value="articles">Articles &amp; Tutorials</option>
                        <option value="products_and_info">AWS Product Information</option>
                        <option value="case_studies">Case Studies</option>
                        <option value="customerapps">Customer Apps</option>
                        <option value="documentation">Documentation</option>
                        <option value="documentation-product">Documentation - This Product</option>
                        <option value="documentation-guide" selected="selected">Documentation - This Guide</option>
                        <option value="datasets">Public Data Sets</option>
                        <option value="releasenotes">Release Notes</option>
                        <option value="solution_providers">Partners</option>
                        <option value="code">Sample Code &amp; Libraries</option></select><br /><input id="search-query" name="searchQuery" type="text" placeholder="Search" /><input id="search-button" src="/images/search-button.png" alt="Go" type="image" /></div><input type="hidden" name="this_doc_product" id="this_doc_product" value="Amazon Elastic Compute Cloud" /><input type="hidden" name="this_doc_guide" id="this_doc_guide" value="User Guide for Linux Instances" /><input type="hidden" name="doc_locale" value="en_us" /></form>
            </div>
            <div id="toc">
               <ul class="awstoc">
                  <li class="awstoc closed"><a class="awstoc" href="concepts.html">What Is Amazon EC2?</a><ul class="awstoc">
                        <li class="awstoc leaf"><a class="awstoc" href="ec2-instances-and-amis.html">Instances and AMIs</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="using-regions-availability-zones.html">Regions and Availability Zones</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="RootDeviceStorage.html">Root Device Volume</a></li>
                     </ul>
                  </li>
                  <li class="awstoc leaf"><a class="awstoc" href="get-set-up-for-amazon-ec2.html">Setting Up</a></li>
                  <li class="awstoc leaf"><a class="awstoc" href="EC2_GetStarted.html">Getting Started</a></li>
                  <li class="awstoc leaf"><a class="awstoc" href="ec2-best-practices.html">Best Practices</a></li>
                  <li class="awstoc closed"><a class="awstoc" href="ec2-tutorials.html">Tutorials</a><ul class="awstoc">
                        <li class="awstoc leaf"><a class="awstoc" href="ec2-lamp-amazon-linux-2.html">Install a LAMP Server (Amazon Linux 2)</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="install-LAMP.html">Install a LAMP Server (Amazon Linux AMI)</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="hosting-wordpress.html">Tutorial: Hosting a WordPress Blog</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="SSL-on-an-instance.html">Tutorial: Configure Apache Web Server on Amazon Linux 2 to Use SSL/TLS</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="ec2-increase-availability.html">Tutorial: Increase the Availability of Your Application</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="tutorial_run_command.html">Tutorial: Remotely Manage Your Instances</a></li>
                     </ul>
                  </li>
                  <li class="awstoc opened"><a class="awstoc" href="AMIs.html">Amazon Machine Images</a><ul class="awstoc">
                        <li class="awstoc leaf"><a class="awstoc" href="ComponentsAMIs.html">AMI Types</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="virtualization_types.html">Virtualization Types</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="finding-an-ami.html">Finding a Linux AMI</a></li>
                        <li class="awstoc closed"><a class="awstoc" href="sharing-amis.html">Shared AMIs</a><ul class="awstoc">
                              <li class="awstoc leaf"><a class="awstoc" href="usingsharedamis-finding.html">Finding Shared AMIs</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="sharingamis-intro.html">Making an AMI Public</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="sharingamis-explicit.html">Sharing an AMI with Specific AWS Accounts</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="using-bookmarks.html">Using Bookmarks</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="building-shared-amis.html">Guidelines for Shared Linux AMIs</a></li>
                           </ul>
                        </li>
                        <li class="awstoc leaf"><a class="awstoc" href="paid-amis.html">Paid AMIs</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="creating-an-ami-ebs.html">Creating an Amazon EBS-Backed Linux AMI</a></li>
                        <li class="awstoc opened"><a class="awstoc" href="creating-an-ami-instance-store.html">Creating an Instance Store-Backed Linux AMI</a><ul class="awstoc">
                              <li class="awstoc leaf"><a class="awstoc" href="set-up-ami-tools.html">Setting Up the AMI Tools</a></li>
                              <li class="awstoc leaf"><a class="awstoc selected" href="create-instance-store-ami.html">Creating an AMI from an Instance Store-Backed Instance</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="Using_ConvertingS3toEBS.html">Converting to an Amazon EBS-Backed AMI</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="ami-tools-commands.html">AMI Tools Reference</a></li>
                           </ul>
                        </li>
                        <li class="awstoc leaf"><a class="awstoc" href="AMIEncryption.html">AMIs with Encrypted Snapshots</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="CopyingAMIs.html">Copying an AMI</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="deregister-ami.html">Deregistering Your Linux AMI</a></li>
                        <li class="awstoc closed"><a class="awstoc" href="amazon-linux-ami-basics.html">Amazon Linux</a><ul class="awstoc">
                              <li class="awstoc leaf"><a class="awstoc" href="amazon-linux-2-virtual-machine.html">Running Amazon Linux 2 as a Virtual Machine On-Premises</a></li>
                           </ul>
                        </li>
                        <li class="awstoc leaf"><a class="awstoc" href="UserProvidedKernels.html">User Provided Kernels</a></li>
                     </ul>
                  </li>
                  <li class="awstoc closed"><a class="awstoc" href="Instances.html">Instances</a><ul class="awstoc">
                        <li class="awstoc closed"><a class="awstoc" href="instance-types.html">Instance Types</a><ul class="awstoc">
                              <li class="awstoc closed"><a class="awstoc" href="burstable-performance-instances.html">Burstable Performance Instances</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="burstable-credits-baseline-concepts.html">CPU Credits and Baseline Performance</a></li>
                                    <li class="awstoc closed"><a class="awstoc" href="burstable-performance-instances-unlimited-mode.html">Unlimited Mode</a><ul class="awstoc">
                                          <li class="awstoc leaf"><a class="awstoc" href="unlimited-mode-examples.html">Examples</a></li>
                                       </ul>
                                    </li>
                                    <li class="awstoc closed"><a class="awstoc" href="burstable-performance-instances-standard-mode.html">Standard Mode</a><ul class="awstoc">
                                          <li class="awstoc leaf"><a class="awstoc" href="standard-mode-examples.html">Examples</a></li>
                                       </ul>
                                    </li>
                                    <li class="awstoc leaf"><a class="awstoc" href="burstable-performance-instances-how-to.html">Working with Burstable Performance Instances</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="burstable-performance-instances-monitoring-cpu-credits.html">Monitoring Your CPU Credits</a></li>
                                 </ul>
                              </li>
                              <li class="awstoc leaf"><a class="awstoc" href="general-purpose-instances.html">General Purpose Instances</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="compute-optimized-instances.html">Compute Optimized Instances</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="memory-optimized-instances.html">Memory Optimized Instances</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="storage-optimized-instances.html">Storage Optimized Instances</a></li>
                              <li class="awstoc closed"><a class="awstoc" href="accelerated-computing-instances.html">Accelerated Computing Instances</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="install-nvidia-driver.html">Installing the NVIDIA Driver on Linux Instances</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="activate_grid.html">Activate NVIDIA GRID Virtual Applications (G3 Instances Only)</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="optimize_gpu.html">Optimizing GPU Settings (P2, P3, and G3 Instances)</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="fpga-getting-started.html">Getting Started with FPGA Development</a></li>
                                 </ul>
                              </li>
                              <li class="awstoc leaf"><a class="awstoc" href="concepts_micro_instances.html">T1 Micro Instances</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="ec2-instance-resize.html">Changing the Instance Type</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="instance-optimize-cpu.html">Optimizing CPU Options</a></li>
                           </ul>
                        </li>
                        <li class="awstoc closed"><a class="awstoc" href="instance-purchasing-options.html">Instance Purchasing Options</a><ul class="awstoc">
                              <li class="awstoc closed"><a class="awstoc" href="ec2-reserved-instances.html">Reserved Instances</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="reserved-instances-types.html">Types of Reserved Instances (Offering Classes)</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="apply_ri.html">How Reserved Instances Are Applied</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="concepts-reserved-instances-application.html">How You Are Billed</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ri-market-concepts-buying.html">Buying Reserved Instances</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ri-market-general.html">Selling on the Reserved Instance Marketplace</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ri-modifying.html">Modifying Reserved Instances</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ri-convertible-exchange.html">Exchanging Convertible Reserved Instances</a></li>
                                 </ul>
                              </li>
                              <li class="awstoc leaf"><a class="awstoc" href="ec2-scheduled-instances.html">Scheduled Instances</a></li>
                              <li class="awstoc closed"><a class="awstoc" href="using-spot-instances.html">Spot Instances</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="how-spot-instances-work.html">How Spot Instances Work</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="spot-fleet.html">How Spot Fleet Works</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="using-spot-instances-history.html">Spot Instance Pricing History</a></li>
                                    <li class="awstoc closed"><a class="awstoc" href="spot-requests.html">Spot Instance Requests</a><ul class="awstoc">
                                          <li class="awstoc leaf"><a class="awstoc" href="spot-request-examples.html">Example Launch Specifications</a></li>
                                       </ul>
                                    </li>
                                    <li class="awstoc closed"><a class="awstoc" href="spot-fleet-requests.html">Spot Fleet Requests</a><ul class="awstoc">
                                          <li class="awstoc leaf"><a class="awstoc" href="spot-fleet-examples.html">Example Configurations</a></li>
                                       </ul>
                                    </li>
                                    <li class="awstoc leaf"><a class="awstoc" href="spot-fleet-cloudwatch-metrics.html">CloudWatch Metrics for Spot Fleet</a></li>
                                    <li class="awstoc closed"><a class="awstoc" href="spot-fleet-automatic-scaling.html">Automatic Scaling for Spot Fleet</a><ul class="awstoc">
                                          <li class="awstoc leaf"><a class="awstoc" href="spot-fleet-target-tracking.html">Target Tracking Scaling Policies</a></li>
                                          <li class="awstoc leaf"><a class="awstoc" href="spot-fleet-step-scaling.html">Step Scaling Policies</a></li>
                                          <li class="awstoc leaf"><a class="awstoc" href="spot-fleet-scheduled-scaling.html">Scheduled Scaling</a></li>
                                       </ul>
                                    </li>
                                    <li class="awstoc leaf"><a class="awstoc" href="spot-bid-status.html">Spot Request Status</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="spot-interruptions.html">Spot Instance Interruptions</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="spot-data-feeds.html">Spot Instance Data Feed</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="using-spot-limits.html">Spot Instance Limits</a></li>
                                 </ul>
                              </li>
                              <li class="awstoc closed"><a class="awstoc" href="dedicated-hosts-overview.html">Dedicated Hosts</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="how-dedicated-hosts-work.html">Working with Dedicated Hosts</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="dedicated-hosts-aws-config.html">Tracking Configuration Changes</a></li>
                                 </ul>
                              </li>
                              <li class="awstoc leaf"><a class="awstoc" href="dedicated-instance.html">Dedicated Instances</a></li>
                           </ul>
                        </li>
                        <li class="awstoc closed"><a class="awstoc" href="ec2-instance-lifecycle.html">Instance Lifecycle</a><ul class="awstoc">
                              <li class="awstoc closed"><a class="awstoc" href="LaunchingAndUsingInstances.html">Launch</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="launching-instance.html">Launching an Instance Using the Launch Instance Wizard</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ec2-launch-templates.html">Launching an Instance from a Launch Template</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="launch-more-like-this.html">Launching an Instance From an Existing Instance</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="instance-launch-snapshot.html">Launching a Linux Instance from a Backup</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="launch-marketplace-console.html">Launching an AWS Marketplace Instance</a></li>
                                    <li class="awstoc closed"><a class="awstoc" href="ec2-fleet.html">Launching an EC2 Fleet</a><ul class="awstoc">
                                          <li class="awstoc leaf"><a class="awstoc" href="ec2-fleet-configuration-strategies.html">EC2 Fleet Configuration Strategies</a></li>
                                          <li class="awstoc closed"><a class="awstoc" href="manage-ec2-fleet.html">Managing an EC2 Fleet</a><ul class="awstoc">
                                                <li class="awstoc leaf"><a class="awstoc" href="ec2-fleet-examples.html">Example Configurations</a></li>
                                             </ul>
                                          </li>
                                       </ul>
                                    </li>
                                 </ul>
                              </li>
                              <li class="awstoc closed"><a class="awstoc" href="AccessingInstances.html">Connect</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="AccessingInstancesLinux.html">Connect Using SSH</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="putty.html">Connect Using PuTTY</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="WSL.html">Connect Using WSL</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="mindterm.html">Connect Using MindTerm</a></li>
                                 </ul>
                              </li>
                              <li class="awstoc leaf"><a class="awstoc" href="Stop_Start.html">Stop and Start</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="ec2-instance-reboot.html">Reboot</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="instance-retirement.html">Retire</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="terminating-instances.html">Terminate</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="ec2-instance-recover.html">Recover</a></li>
                           </ul>
                        </li>
                        <li class="awstoc closed"><a class="awstoc" href="Configure_Instance.html">Configure Instances</a><ul class="awstoc">
                              <li class="awstoc closed"><a class="awstoc" href="managing-software.html">Managing Software</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="install-updates.html">Updating Instance Software</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="add-repositories.html">Adding Repositories</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="find-software.html">Finding Software Packages</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="install-software.html">Installing Software Packages</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="compile-software.html">Preparing to Compile Software</a></li>
                                 </ul>
                              </li>
                              <li class="awstoc leaf"><a class="awstoc" href="managing-users.html">Managing Users</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="processor_state_control.html">Processor State Control</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="set-time.html">Setting the Time</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="set-hostname.html">Changing the Hostname</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="dynamic-dns.html">Setting Up Dynamic DNS</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="user-data.html">Running Commands at Launch</a></li>
                              <li class="awstoc closed"><a class="awstoc" href="ec2-instance-metadata.html">Instance Metadata and User Data</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="instance-identity-documents.html">Instance Identity Documents</a></li>
                                 </ul>
                              </li>
                           </ul>
                        </li>
                        <li class="awstoc leaf"><a class="awstoc" href="identify_ec2_instances.html">Identify Instances</a></li>
                     </ul>
                  </li>
                  <li class="awstoc closed"><a class="awstoc" href="monitoring_ec2.html">Monitoring</a><ul class="awstoc">
                        <li class="awstoc leaf"><a class="awstoc" href="monitoring_automated_manual.html">Automated and Manual Monitoring</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="monitoring_best_practices.html">Best Practices for Monitoring</a></li>
                        <li class="awstoc closed"><a class="awstoc" href="monitoring-instances-status-check.html">Monitoring the Status of Your Instances</a><ul class="awstoc">
                              <li class="awstoc leaf"><a class="awstoc" href="monitoring-system-instance-status-check.html">Instance Status Checks</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="monitoring-instances-status-check_sched.html">Scheduled Events</a></li>
                           </ul>
                        </li>
                        <li class="awstoc closed"><a class="awstoc" href="using-cloudwatch.html">Monitoring Your Instances Using CloudWatch</a><ul class="awstoc">
                              <li class="awstoc leaf"><a class="awstoc" href="using-cloudwatch-new.html">Enable Detailed Monitoring</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="viewing_metrics_with_cloudwatch.html">List Available Metrics</a></li>
                              <li class="awstoc closed"><a class="awstoc" href="monitoring_get_statistics.html">Get Statistics for Metrics</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="US_SingleMetricPerInstance.html">Get Statistics for a Specific Instance</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="GetSingleMetricAllDimensions.html">Aggregate Statistics Across Instances</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="GetMetricAutoScalingGroup.html">Aggregate Statistics by Auto Scaling Group</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="US_SingleMetricPerAMI.html">Aggregate Statistics by AMI</a></li>
                                 </ul>
                              </li>
                              <li class="awstoc leaf"><a class="awstoc" href="graphs-in-the-aws-management-console.html">Graph Metrics</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="using-cloudwatch-createalarm.html">Create an Alarm</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="UsingAlarmActions.html">Create Alarms That Stop, Terminate, Reboot, or Recover an Instance</a></li>
                           </ul>
                        </li>
                        <li class="awstoc leaf"><a class="awstoc" href="automating_with_cloudwatch_events.html">Automating Amazon EC2 with CloudWatch Events</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="mon-scripts.html">Monitoring Memory and Disk Metrics</a></li>
                     </ul>
                  </li>
                  <li class="awstoc closed"><a class="awstoc" href="EC2_Network_and_Security.html">Network and Security</a><ul class="awstoc">
                        <li class="awstoc leaf"><a class="awstoc" href="ec2-key-pairs.html">Key Pairs</a></li>
                        <li class="awstoc closed"><a class="awstoc" href="using-network-security.html">Security Groups</a><ul class="awstoc">
                              <li class="awstoc leaf"><a class="awstoc" href="security-group-rules-reference.html">Security Group Rules Reference</a></li>
                           </ul>
                        </li>
                        <li class="awstoc closed"><a class="awstoc" href="UsingIAM.html">Controlling Access</a><ul class="awstoc">
                              <li class="awstoc closed"><a class="awstoc" href="iam-policies-for-amazon-ec2.html">IAM Policies</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="iam-policy-structure.html">Policy Structure</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ec2-supported-iam-actions-resources.html">Supported Resource-Level Permissions</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ExamplePolicies_EC2.html">Example Policies for CLI or SDK</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="iam-policies-ec2-console.html">Example Policies for the Console</a></li>
                                 </ul>
                              </li>
                              <li class="awstoc leaf"><a class="awstoc" href="iam-roles-for-amazon-ec2.html">IAM Roles</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="authorizing-access-to-an-instance.html">Network Access</a></li>
                           </ul>
                        </li>
                        <li class="awstoc closed"><a class="awstoc" href="using-instance-addressing.html">Instance IP Addressing</a><ul class="awstoc">
                              <li class="awstoc leaf"><a class="awstoc" href="MultipleIP.html">Multiple IP Addresses</a></li>
                           </ul>
                        </li>
                        <li class="awstoc leaf"><a class="awstoc" href="elastic-ip-addresses-eip.html">Elastic IP Addresses</a></li>
                        <li class="awstoc closed"><a class="awstoc" href="using-eni.html">Network Interfaces</a><ul class="awstoc">
                              <li class="awstoc leaf"><a class="awstoc" href="requester-managed-eni.html">Requester-Managed Network Interfaces</a></li>
                           </ul>
                        </li>
                        <li class="awstoc closed"><a class="awstoc" href="enhanced-networking.html">Enhanced Networking</a><ul class="awstoc">
                              <li class="awstoc leaf"><a class="awstoc" href="sriov-networking.html">Enhanced Networking: Intel 82599 VF</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="enhanced-networking-ena.html">Enhanced Networking: ENA</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="troubleshooting-ena.html">Troubleshooting ENA</a></li>
                           </ul>
                        </li>
                        <li class="awstoc leaf"><a class="awstoc" href="placement-groups.html">Placement Groups</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="network_mtu.html">Network MTU</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="using-vpc.html">Virtual Private Clouds</a></li>
                        <li class="awstoc closed"><a class="awstoc" href="ec2-classic-platform.html">EC2-Classic</a><ul class="awstoc">
                              <li class="awstoc leaf"><a class="awstoc" href="vpc-classiclink.html">ClassicLink</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="vpc-migrate.html">Migrating from EC2-Classic to a VPC</a></li>
                           </ul>
                        </li>
                     </ul>
                  </li>
                  <li class="awstoc closed"><a class="awstoc" href="Storage.html">Storage</a><ul class="awstoc">
                        <li class="awstoc closed"><a class="awstoc" href="AmazonEBS.html">Amazon EBS</a><ul class="awstoc">
                              <li class="awstoc closed"><a class="awstoc" href="EBSVolumes.html">EBS Volumes</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="EBSVolumeTypes.html">EBS Volume Types</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-creating-volume.html">Creating a Volume</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-restoring-volume.html">Restoring from a Snapshot</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-attaching-volume.html">Attaching a Volume to an Instance</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-using-volumes.html">Making a Volume Available for Use</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-describing-volumes.html">Volume Information</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="monitoring-volume-status.html">Monitoring the Status of Your Volumes</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-detaching-volume.html">Detaching a Volume from an Instance</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-deleting-volume.html">Deleting a Volume</a></li>
                                    <li class="awstoc closed"><a class="awstoc" href="ebs-modify-volume.html">Modifying a Volume</a><ul class="awstoc">
                                          <li class="awstoc leaf"><a class="awstoc" href="volume_constraints.html">Volume Size Constraints</a></li>
                                          <li class="awstoc leaf"><a class="awstoc" href="console-modify.html">Using the Console</a></li>
                                          <li class="awstoc leaf"><a class="awstoc" href="cli-modify.html">Using the CLI</a></li>
                                          <li class="awstoc leaf"><a class="awstoc" href="monitoring_mods.html">Monitoring Progress</a></li>
                                          <li class="awstoc leaf"><a class="awstoc" href="expand-linux-partition.html">Expanding a Linux Partition</a></li>
                                          <li class="awstoc leaf"><a class="awstoc" href="recognize-expanded-volume-linux.html">Extending Linux File Systems</a></li>
                                          <li class="awstoc leaf"><a class="awstoc" href="limitations.html">Limitations</a></li>
                                          <li class="awstoc leaf"><a class="awstoc" href="stop-start.html">Appendix: Manual Stop/Start Modification</a></li>
                                       </ul>
                                    </li>
                                 </ul>
                              </li>
                              <li class="awstoc closed"><a class="awstoc" href="EBSSnapshots.html">EBS Snapshots</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-creating-snapshot.html">Creating a Snapshot</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-deleting-snapshot.html">Deleting a Snapshot</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-copy-snapshot.html">Copying a Snapshot</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-describing-snapshots.html">Viewing Snapshot Information</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-modifying-snapshot-permissions.html">Sharing a Snapshot</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="snapshot-lifecycle.html">Automating Snapshots</a></li>
                                 </ul>
                              </li>
                              <li class="awstoc leaf"><a class="awstoc" href="EBSOptimized.html">EBS Optimization</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="EBSEncryption.html">EBS Encryption</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="nvme-ebs-volumes.html">EBS Volumes and NVMe</a></li>
                              <li class="awstoc closed"><a class="awstoc" href="EBSPerformance.html">EBS Performance</a><ul class="awstoc">
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-ec2-config.html">EC2 Configuration</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-io-characteristics.html">I/O Characteristics and Monitoring</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="ebs-initialize.html">Initialize Volumes</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="raid-config.html">RAID Configuration</a></li>
                                    <li class="awstoc leaf"><a class="awstoc" href="benchmark_procedures.html">Benchmark EBS Volumes</a></li>
                                 </ul>
                              </li>
                              <li class="awstoc leaf"><a class="awstoc" href="ebs-cloud-watch-events.html">EBS CloudWatch Events</a></li>
                           </ul>
                        </li>
                        <li class="awstoc closed"><a class="awstoc" href="InstanceStorage.html">Instance Store</a><ul class="awstoc">
                              <li class="awstoc leaf"><a class="awstoc" href="add-instance-store-volumes.html">Add Instance Store Volumes</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="ssd-instance-store.html">SSD Instance Store Volumes</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="instance-store-swap-volumes.html">Instance Store Swap Volumes</a></li>
                              <li class="awstoc leaf"><a class="awstoc" href="disk-performance.html">Optimizing Disk Performance</a></li>
                           </ul>
                        </li>
                        <li class="awstoc leaf"><a class="awstoc" href="AmazonEFS.html">Amazon EFS</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="AmazonS3.html">Amazon S3</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="volume_limits.html">Instance Volume Limits</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="device_naming.html">Device Naming</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="block-device-mapping-concepts.html">Block Device Mapping</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="using-public-data-sets.html">Using Public Data Sets</a></li>
                     </ul>
                  </li>
                  <li class="awstoc closed"><a class="awstoc" href="EC2_Resources.html">Resources and Tags</a><ul class="awstoc">
                        <li class="awstoc leaf"><a class="awstoc" href="resources.html">Resource Locations</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="resource-ids.html">Resource IDs</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="Using_Filtering.html">Listing and Filtering Your Resources</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="Using_Tags.html">Tagging Your Resources</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="ec2-resource-limits.html">Service Limits</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="usage-reports.html">Usage Reports</a></li>
                     </ul>
                  </li>
                  <li class="awstoc closed"><a class="awstoc" href="Linux-Server-EC2Rescue.html">EC2Rescue for Linux</a><ul class="awstoc">
                        <li class="awstoc leaf"><a class="awstoc" href="ec2rl_install.html">Installing EC2Rescue for Linux</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="ec2rl_verify.html">(Optional) Verify the Signature of EC2Rescue for Linux</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="ec2rl_working.html">Working with EC2Rescue for Linux</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="ec2rl_moduledev.html">Developing EC2Rescue Modules</a></li>
                     </ul>
                  </li>
                  <li class="awstoc closed"><a class="awstoc" href="ec2-instance-troubleshoot.html">Troubleshooting</a><ul class="awstoc">
                        <li class="awstoc leaf"><a class="awstoc" href="troubleshooting-launch.html">Troubleshooting Launch Issues</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="TroubleshootingInstancesConnecting.html">Connecting to Your Instance</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="TroubleshootingInstancesStopping.html">Stopping Your Instance</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="TroubleshootingInstancesShuttingDown.html">Terminating Your Instance</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="TroubleshootingInstanceRecovery.html">Instance Recovery Failures</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="TroubleshootingInstances.html">Failed Status Checks</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="instance-console.html">Getting Console Output and Rebooting Instances</a></li>
                        <li class="awstoc leaf"><a class="awstoc" href="instance-booting-from-wrong-volume.html">Booting from the Wrong Volume</a></li>
                     </ul>
                  </li>
                  <li class="awstoc leaf"><a class="awstoc" href="DocumentHistory.html">Document History</a></li>
                  <li class="awstoc leaf"><a class="awstoc" href="glossary.html">AWS Glossary</a></li>
                  <li id="toc-additional-links"><a class="btn btn-pdf-link" id="pdf-link-alt" href="ec2-ug.pdf#top" target="_blank" title="Open PDF"></a><a class="btn btn-kindle-link" id="kindle-link-alt" target="_blank" href="http://www.amazon.com/dp/B076452RSZ" title="Open Kindle"></a><a class="btn btn-rss-link" id="rss-link-alt" target="_blank" href="amazon-ec2-release-notes.rss" title="View RSS Feed"></a></li>
               </ul>
            </div>
         </div>
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tr>
                           <td>
                              <div class="breadcrumb"><a href="/index.html">AWS Documentation</a> » <a href="/ec2/index.html">Amazon EC2</a> » <a href="index.html">User Guide for Linux Instances</a> » <a href="AMIs.html">Amazon Machine Images (AMI)</a> » <a href="creating-an-ami-instance-store.html">Creating an Instance Store-Backed Linux AMI</a> » <span class="breadcrumb">Creating an AMI from an Instance Store-Backed
                                    			Instance</span></div>
                           </td>
                        </tr>
                     </table>
                     <div></div>
                     <h1 class="topictitle" id="create-instance-store-ami">Creating an AMI from an Instance Store-Backed
                        			Instance
                     </h1>
                     <p>The following procedures are for creating an instance store-backed AMI from an
                        			instance store-backed instance. Before you begin, ensure that you've read the <a href="creating-an-ami-instance-store.html#bundle-ami-prerequisites">Prerequisites</a>.
                     </p>
                     <div class="highlights" id="inline-topiclist">
                        <p><strong>Topics</strong></p>
                        <ul>
                           <li><a href="#amazon_linux_instructions">Creating an AMI from an Instance
                                 					Store-Backed Amazon Linux Instance</a></li>
                           <li><a href="#ubuntu_instructions">Creating an AMI from an Instance Store-Backed
                                 				Ubuntu Instance</a></li>
                        </ul>
                     </div>
                     			
                     <h2 id="amazon_linux_instructions">Creating an AMI from an Instance
                        					Store-Backed Amazon Linux Instance
                     </h2>
                     			
                     <p>This section describes the creation of an AMI from an Amazon Linux instance. The
                        				following procedures may not work for instances running other Linux distributions.
                        				For Ubuntu-specific procedures, see <a href="create-instance-store-ami.html#ubuntu_instructions">Creating an AMI from an Instance Store-Backed
                           				Ubuntu Instance</a>.
                     </p>
                     			
                     			
                     <p class="title"><b>To prepare to use the AMI tools (HVM instances only) </b></p>
                     <ol>
                        <li>
                           					
                           <p>The AMI tools require GRUB Legacy to boot properly. Use the following
                              						command to install GRUB:
                           </p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><strong class="userinput"><code>sudo yum install -y grub</code></strong></code></pre>
                           				</li>
                        <li>
                           					
                           <p>Install the partition management packages with the following
                              						command:
                           </p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><strong class="userinput"><code>sudo yum install -y gdisk kpartx parted</code></strong></code></pre>
                           				</li>
                     </ol>
                     			
                     <p class="title"><b>To create an AMI from an instance store-backed Amazon Linux instance</b></p>
                     <p>This procedure assumes that you have satisfied the prerequisites in <a href="creating-an-ami-instance-store.html#bundle-ami-prerequisites">Prerequisites</a>.
                     </p>
                     <ol>
                        <li>
                           					
                           <p>Upload your credentials to your instance. We use these credentials to
                              						ensure that only you and Amazon EC2 can access your AMI.
                           </p>
                           					
                           <ol>
                              <li>
                                 							
                                 <p>Create a temporary directory on your instance for your credentials
                                    								as follows:
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><strong class="userinput"><code>mkdir /tmp/cert</code></strong></code></pre>
                                 							<p>This enables you to exclude your credentials from the created
                                    								image.
                                 </p>
                                 						
                              </li>
                              <li>
                                 							
                                 <p>Copy your X.509 certificate and corresponding private key from
                                    								your computer to the <code>/tmp/cert</code> directory on
                                    								your instance using a secure copy tool such as <a href="AccessingInstancesLinux.html#AccessingInstancesLinuxSCP">scp</a>. The <code class="code">-i
                                       										<em class="replaceable"><code>my-private-key</code></em>.pem</code> option
                                    								in the following <b>scp</b> command is the private key
                                    								you use to connect to your instance with SSH, not the X.509 private
                                    								key. For example:
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">you@your_computer:~ $ </code><strong class="userinput"><code>scp -i <em class="replaceable"><code>my-private-key</code></em>.pem <em class="replaceable"><code>/path/to/pk-HKZYKTAIG2ECMXYIBH3HXV4ZBEXAMPLE.pem</code></em> <em class="replaceable"><code>/path/to/cert-HKZYKTAIG2ECMXYIBH3HXV4ZBEXAMPLE.pem</code></em> ec2-user@<em class="replaceable"><code>ec2-203-0-113-25.compute-1.amazonaws.com</code></em>:/tmp/cert/</code></strong><code class="computeroutput" copy="false">
pk-HKZYKTAIG2ECMXYIBH3HXV4ZBEXAMPLE.pem  100%  717     0.7KB/s   00:00
cert-HKZYKTAIG2ECMXYIBH3HXV4ZBEXAMPLE.pem  100%  685     0.7KB/s   00:00</code></code></pre>
                                 						</li>
                           </ol>
                           					
                           <p>Alternatively, because these are plain text files, you can open the
                              						certificate and key in a text editor and copy their contents into new files
                              						in <code>/tmp/cert</code>.
                           </p>
                           				
                        </li>
                        <li><a id="step_with_bundle_path_amazon_linux"></a>
                           					
                           <p>Prepare the bundle to upload to Amazon S3 by running the <a href="ami-tools-commands.html#ami-bundle-vol">ec2-bundle-vol</a> command from
                              						inside your instance. Be sure to specify the <code class="code">-e</code> option to
                              						exclude the directory where your credentials are stored. By default, the
                              						bundle process excludes files that might contain sensitive information.
                              						These files include <code>*.sw</code>, <code>*.swo</code>,
                              							<code>*.swp</code>, <code>*.pem</code>,
                              							<code>*.priv</code>, <code>*id_rsa*</code>,
                              							<code>*id_dsa*</code>
                              						<code>*.gpg</code>, <code>*.jks</code>,
                              							<code>*/.ssh/authorized_keys</code>, and
                              							<code>*/.bash_history</code>. To include all of these files, use
                              						the <code class="code">--no-filter</code> option. To include some of these files, use the
                              							<code class="code">--include</code> option.
                           </p>
                           					
                           <div class="aws-note">
                              <p class="aws-note">Important</p>
                              <p>By default, the AMI bundling process creates a compressed, encrypted
                                 							collection of files in the <code>/tmp</code> directory that
                                 							represents your root volume. If you do not have enough free disk space
                                 							in <code>/tmp</code> to store the bundle, you need to specify a
                                 							different location for the bundle to be stored with the <code class="code">-d
                                    									<em class="replaceable"><code>/path/to/bundle/storage</code></em></code>
                                 							option. Some instances have ephemeral storage mounted at
                                 								<code>/mnt</code> or <code>/media/ephemeral0</code>
                                 							that you can use, or you can also <a href="ebs-creating-volume.html">create</a>, <a href="ebs-attaching-volume.html">attach</a>,
                                 							and <a href="ebs-using-volumes.html">mount</a> a new Amazon EBS volume to
                                 							store the bundle.
                              </p>
                           </div>
                           					
                           <ol>
                              <li>
                                 							
                                 <p>You must run the <b>ec2-bundle-vol</b> command as
                                    								root. For most commands, you can use <b>sudo</b> to gain
                                    								elevated permissions, but in this case, you should run <b>sudo
                                       									-E su</b> to keep your environment variables.
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><strong class="userinput"><code>sudo -E su</code></strong></code></pre>
                                 							<p>Note that bash prompt now identifies you as the root user, and
                                    								that the dollar sign has been replaced by a hash tag, signalling
                                    								that you are in a root shell:
                                 </p>
                                 							<pre class="screen">[root ec2-user]#</pre>
                                 						</li>
                              <li>
                                 							
                                 <p>To create the AMI bundle, run the <a href="ami-tools-commands.html#ami-bundle-vol">ec2-bundle-vol</a> command as follows:
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">[root ec2-user]# </code><strong class="userinput"><code>ec2-bundle-vol -k /tmp/cert/<em class="replaceable"><code>pk-HKZYKTAIG2ECMXYIBH3HXV4ZBEXAMPLE.pem</code></em> -c /tmp/cert/<em class="replaceable"><code>cert-HKZYKTAIG2ECMXYIBH3HXV4ZBEXAMPLE.pem</code></em> -u <em class="replaceable"><code>123456789012</code></em> -r x86_64 -e /tmp/cert --partition <em class="replaceable"><code>gpt</code></em></code></strong></code></pre>
                                 							<div class="aws-note">
                                    <p class="aws-note">Note</p>
                                    <p>For the China (Beijing) and AWS GovCloud (US)
                                       									regions, use the <code class="code">--ec2cert</code> parameter and specify
                                       									the certificates as per the <a href="creating-an-ami-instance-store.html#bundle-ami-prerequisites">prerequisites</a>.
                                    </p>
                                 </div>
                                 							
                                 <p>It can take a few minutes to create the image. When this command
                                    								completes, your <code>/tmp</code> (or non-default) directory
                                    								contains the bundle (<code>image.manifest.xml</code>, plus
                                    								multiple
                                    									<code>image.part.</code><em class="replaceable"><code>xx</code></em>
                                    								files).
                                 </p>
                                 						
                              </li>
                              <li>
                                 							
                                 <p>Exit from the root shell.</p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">[root ec2-user]# </code><strong class="userinput"><code>exit</code></strong></code></pre>
                                 						</li>
                           </ol>
                           				
                        </li>
                        <li>
                           					
                           <p>(Optional) To add more instance store volumes, edit the block device
                              						mappings in the <code>image.manifest.xml</code> file for your AMI.
                              						For more information, see <a href="block-device-mapping-concepts.html">Block Device Mapping</a>.
                           </p>
                           					
                           <ol>
                              <li>
                                 							
                                 <p>Create a backup of your <code>image.manifest.xml</code>
                                    								file.
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><strong class="userinput"><code>sudo cp /tmp/image.manifest.xml /tmp/image.manifest.xml.bak</code></strong></code></pre>
                                 						</li>
                              <li>
                                 							
                                 <p>Reformat the <code>image.manifest.xml</code> file so that
                                    								it is easier to read and edit.
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><strong class="userinput"><code>sudo xmllint --format /tmp/image.manifest.xml.bak &gt; sudo /tmp/image.manifest.xml</code></strong></code></pre>
                                 						</li>
                              <li>
                                 							
                                 <p>Edit the block device mappings in
                                    									<code>image.manifest.xml</code> with a text editor. The
                                    								example below shows a new entry for the
                                    									<code>ephemeral1</code> instance store volume.
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">    &lt;block_device_mapping&gt;
      &lt;mapping&gt;
        &lt;virtual&gt;ami&lt;/virtual&gt;
        &lt;device&gt;sda&lt;/device&gt;
      &lt;/mapping&gt;
      &lt;mapping&gt;
        &lt;virtual&gt;ephemeral0&lt;/virtual&gt;
        &lt;device&gt;sdb&lt;/device&gt;
      &lt;/mapping&gt;
<em class="replaceable"><code>      &lt;mapping&gt;
        &lt;virtual&gt;ephemeral1&lt;/virtual&gt;
        &lt;device&gt;sdc&lt;/device&gt;
      &lt;/mapping&gt;</code></em>
      &lt;mapping&gt;
        &lt;virtual&gt;root&lt;/virtual&gt;
        &lt;device&gt;/dev/sda1&lt;/device&gt;
      &lt;/mapping&gt;
    &lt;/block_device_mapping&gt;</code></pre>
                                 						</li>
                              <li>
                                 							
                                 <p>Save the <code>image.manifest.xml</code> file and exit
                                    								your text editor.
                                 </p>
                                 						
                              </li>
                           </ol>
                           				
                        </li>
                        <li>
                           					
                           <p>To upload your bundle to Amazon S3, run the <a href="ami-tools-commands.html#ami-upload-bundle">ec2-upload-bundle</a> command as follows.
                           </p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><strong class="userinput"><code>ec2-upload-bundle -b <em class="replaceable"><code>my-s3-bucket</code></em>/<em class="replaceable"><code>bundle_folder</code></em>/<em class="replaceable"><code>bundle_name</code></em> -m /tmp/image.manifest.xml -a <em class="replaceable"><code>your_access_key_id</code></em> -s <em class="replaceable"><code>your_secret_access_key</code></em></code></strong></code></pre>
                           					<div class="aws-note">
                              <p class="aws-note">Important</p>
                              <p>To register your AMI in a region other than US East (N. Virginia), you
                                 							must specify both the target region with the <code class="code">--region</code>
                                 							option and a bucket path that already exists in the target region or a
                                 							unique bucket path that can be created in the target region.
                              </p>
                           </div>
                           				
                        </li>
                        <li>
                           					
                           <p>(Optional) After the bundle is uploaded to Amazon S3, you can remove the bundle
                              						from the <code>/tmp</code> directory on the instance using the
                              						following <b>rm</b> command:
                           </p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><strong class="userinput"><code>sudo rm /tmp/image.manifest.xml /tmp/image.part.* /tmp/image</code></strong></code></pre>
                           					<div class="aws-note">
                              <p class="aws-note">Important</p>
                              <p>If you specified a path with the <code class="code">-d
                                    									<em class="replaceable"><code>/path/to/bundle/storage</code></em></code> option
                                 							in <a href="create-instance-store-ami.html#step_with_bundle_path_amazon_linux">Step 2</a>, use that path
                                 							instead of <code>/tmp</code>.
                              </p>
                           </div>
                           				
                        </li>
                        <li>
                           					
                           <p>To register your AMI, run the <a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/register-image.html" target="_blank">register-image</a>
                              						command as follows.
                           </p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">[ec2-user ~]$ </code><strong class="userinput"><code>aws ec2 register-image --image-location <em class="replaceable"><code>my-s3-bucket</code></em>/<em class="replaceable"><code>bundle_folder</code></em>/<em class="replaceable"><code>bundle_name</code></em>/image.manifest.xml --name <em class="replaceable"><code>AMI_name</code></em> --virtualization-type <em class="replaceable"><code>hvm</code></em></code></strong></code></pre>
                           					<div class="aws-note">
                              <p class="aws-note">Important</p>
                              <p>If you previously specified a region for the <a href="ami-tools-commands.html#ami-upload-bundle">ec2-upload-bundle</a>
                                 							command, specify that region again for this command.
                              </p>
                           </div>
                           				
                        </li>
                     </ol>
                     		
                     <h2 id="ubuntu_instructions">Creating an AMI from an Instance Store-Backed
                        				Ubuntu Instance
                     </h2>
                     			
                     			
                     <p>This section describes the creation of an AMI from an Ubuntu Linux instance. The
                        				following procedures may not work for instances running other Linux distributions.
                        				For procedures specific to Amazon Linux, see <a href="create-instance-store-ami.html#amazon_linux_instructions">Creating an AMI from an Instance
                           					Store-Backed Amazon Linux Instance</a>.
                     </p>
                     			
                     <p class="title"><b>To prepare to use the AMI Tools (HVM instances only) </b></p>
                     <p>The AMI tools require GRUB Legacy to boot properly. However, Ubuntu is
                        					configured to use GRUB 2. You must check to see that your instance uses GRUB
                        					Legacy, and if not, you need to install and configure it.
                     </p>
                     <p>HVM instances also require partitioning tools to be installed for the AMI
                        					tools to work properly.
                     </p>
                     <ol>
                        <li>
                           					
                           <p>GRUB Legacy (version 0.9<em class="replaceable"><code>x</code></em> or less) must be
                              						installed on your instance. Check to see if GRUB Legacy is present and
                              						install it if necessary.
                           </p>
                           					
                           <ol>
                              <li>
                                 							
                                 <p>Check the version of your GRUB installation.</p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>grub-install --version</code></strong>
<code class="computeroutput" copy="false">grub-install (GRUB) 1.99-21ubuntu3.10</code></code></pre>
                                 							<p>In this example, the GRUB version is greater than
                                    									0.9<em class="replaceable"><code>x</code></em>, so GRUB Legacy must be
                                    								installed. Proceed to <a href="create-instance-store-ami.html#grub-install-step">Step 2</a>. If GRUB
                                    								Legacy is already present, you can skip to <a href="create-instance-store-ami.html#partition">Step 2</a>.
                                 </p>
                                 						
                              </li>
                              <li><a id="grub-install-step"></a>
                                 							
                                 <p>Install the <code>grub</code> package using the following
                                    								command.
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>sudo apt-get install -y grub</code></strong></code></pre>
                                 							<p>Verify that your instance is using GRUB Legacy.</p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>grub --version</code></strong>
<code class="computeroutput" copy="false">grub (GNU GRUB 0.97)</code></code></pre>
                                 						</li>
                           </ol>
                           				
                        </li>
                        <li><a id="partition"></a>
                           					
                           <p>Install the following partition management packages using the package
                              						manager for your distribution. 
                           </p>
                           					
                           <div class="itemizedlist">
                              						
                              						
                              						
                              					
                              <ul class="itemizedlist" type="disc">
                                 <li class="listitem">
                                    							
                                    <p><code>gdisk</code> (some distributions may call this
                                       								package <code>gptfdisk</code> instead) 
                                    </p>
                                    						
                                 </li>
                                 <li class="listitem">
                                    							
                                    <p><code>kpartx</code></p>
                                    						
                                 </li>
                                 <li class="listitem">
                                    							
                                    <p><code>parted</code></p>
                                    						
                                 </li>
                              </ul>
                           </div>
                           					
                           <p>Use the following command.</p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>sudo apt-get install -y gdisk kpartx parted</code></strong></code></pre>
                           				</li>
                        <li>
                           					
                           <p>Check the kernel parameters for your instance.</p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>cat /proc/cmdline</code></strong>
<code class="computeroutput" copy="false">BOOT_IMAGE=/boot/vmlinuz-3.2.0-54-virtual root=UUID=4f392932-ed93-4f8f-aee7-72bc5bb6ca9d ro console=ttyS0 xen_emul_unplug=unnecessary</code></code></pre>
                           					<p>Note the options following the kernel and root device parameters:
                              							<code class="code">ro</code>, <code class="code">console=ttyS0</code>, and
                              							<code class="code">xen_emul_unplug=unnecessary</code>. Your options may
                              						differ.
                           </p>
                           				
                        </li>
                        <li>
                           					
                           <p>Check the kernel entries in
                              						<code>/boot/grub/menu.lst</code>.
                           </p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>grep ^kernel /boot/grub/menu.lst</code></strong>
<code class="computeroutput" copy="false">kernel		/boot/vmlinuz-3.2.0-54-virtual root=LABEL=cloudimg-rootfs ro console=hvc0
kernel		/boot/vmlinuz-3.2.0-54-virtual root=LABEL=cloudimg-rootfs ro single
kernel		/boot/memtest86+.bin</code></code></pre>
                           					<p>Note that the <code class="code">console</code> parameter is pointing to
                              							<code class="code">hvc0</code> instead of <code class="code">ttyS0</code> and that the
                              							<code class="code">xen_emul_unplug=unnecessary</code> parameter is missing. Again,
                              						your options may differ.
                           </p>
                           				
                        </li>
                        <li>
                           					
                           <p>Edit the <code>/boot/grub/menu.lst</code> file with your favorite
                              						text editor (such as <b>vim</b> or <b>nano</b>) to
                              						change the console and add the parameters you identified earlier to the boot
                              						entries.
                           </p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">title           Ubuntu 12.04.3 LTS, kernel 3.2.0-54-virtual
root            (hd0)
kernel          /boot/vmlinuz-3.2.0-54-virtual root=LABEL=cloudimg-rootfs ro <strong class="userinput"><code>console=ttyS0 xen_emul_unplug=unnecessary</code></strong>
initrd          /boot/initrd.img-3.2.0-54-virtual

title           Ubuntu 12.04.3 LTS, kernel 3.2.0-54-virtual (recovery mode)
root            (hd0)
kernel          /boot/vmlinuz-3.2.0-54-virtual root=LABEL=cloudimg-rootfs ro single <strong class="userinput"><code>console=ttyS0 xen_emul_unplug=unnecessary</code></strong>
initrd          /boot/initrd.img-3.2.0-54-virtual

title           Ubuntu 12.04.3 LTS, memtest86+
root            (hd0)
kernel          /boot/memtest86+.bin</code></pre>
                           				</li>
                        <li>
                           					
                           <p>Verify that your kernel entries now contain the correct parameters.</p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>grep ^kernel /boot/grub/menu.lst</code></strong>
<code class="computeroutput" copy="false">kernel		/boot/vmlinuz-3.2.0-54-virtual root=LABEL=cloudimg-rootfs ro console=ttyS0 xen_emul_unplug=unnecessary
kernel		/boot/vmlinuz-3.2.0-54-virtual root=LABEL=cloudimg-rootfs ro single console=ttyS0 xen_emul_unplug=unnecessary
kernel		/boot/memtest86+.bin</code></code></pre>
                           				</li>
                        <li>
                           					
                           <p>[For Ubuntu 14.04 and later only] Starting with Ubuntu 14.04, instance
                              						store backed Ubuntu AMIs use a GPT partition table and a separate EFI
                              						partition mounted at <code>/boot/efi</code>. The
                              							<b>ec2-bundle-vol</b> command will not bundle this boot
                              						partition, so you need to comment out the <code>/etc/fstab</code>
                              						entry for the EFI partition as shown in the following example.
                           </p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">LABEL=cloudimg-rootfs   /        ext4   defaults        0 0
<strong class="userinput"><code>#</code></strong>LABEL=UEFI     /boot/efi       vfat    defaults        0 0
/dev/xvdb       /mnt    auto    defaults,nobootwait,comment=cloudconfig 0       2</code></pre>
                           				</li>
                     </ol>
                     			
                     <p class="title"><b>To create an AMI from an instance store-backed Ubuntu instance</b></p>
                     <p>This procedure assumes that you have satisfied the prerequisites in <a href="creating-an-ami-instance-store.html#bundle-ami-prerequisites">Prerequisites</a>.
                     </p>
                     <ol>
                        <li>
                           					
                           <p>Upload your credentials to your instance. We use these credentials to
                              						ensure that only you and Amazon EC2 can access your AMI.
                           </p>
                           					
                           <ol>
                              <li>
                                 							
                                 <p>Create a temporary directory on your instance for your credentials
                                    								as follows:
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>mkdir /tmp/cert</code></strong></code></pre>
                                 							<p>This enables you to exclude your credentials from the created
                                    								image.
                                 </p>
                                 						
                              </li>
                              <li>
                                 							
                                 <p>Copy your X.509 certificate and private key from your computer to
                                    								the <code>/tmp/cert</code> directory on your instance, using
                                    								a secure copy tool such as <a href="AccessingInstancesLinux.html#AccessingInstancesLinuxSCP">scp</a>. The <code class="code">-i
                                       										<em class="replaceable"><code>my-private-key</code></em>.pem</code> option
                                    								in the following <b>scp</b> command is the private key
                                    								you use to connect to your instance with SSH, not the X.509 private
                                    								key. For example:
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">you@your_computer:~ $ </code><strong class="userinput"><code>scp -i <em class="replaceable"><code>my-private-key</code></em>.pem <em class="replaceable"><code>/path/to/pk-HKZYKTAIG2ECMXYIBH3HXV4ZBEXAMPLE.pem</code></em> <em class="replaceable"><code>/path/to/cert-HKZYKTAIG2ECMXYIBH3HXV4ZBEXAMPLE.pem</code></em> ec2-user@<em class="replaceable"><code>ec2-203-0-113-25.compute-1.amazonaws.com</code></em>:/tmp/cert/</code></strong>
<code class="computeroutput" copy="false">pk-HKZYKTAIG2ECMXYIBH3HXV4ZBEXAMPLE.pem  100%  717     0.7KB/s   00:00
cert-HKZYKTAIG2ECMXYIBH3HXV4ZBEXAMPLE.pem  100%  685     0.7KB/s   00:00</code></code></pre>
                                 						</li>
                           </ol>
                           					
                           <p>Alternatively, because these are plain text files, you can open the
                              						certificate and key in a text editor and copy their contents into new files
                              						in <code>/tmp/cert</code>.
                           </p>
                           				
                        </li>
                        <li><a id="step_with_bundle_path_ubuntu"></a>
                           					
                           <p>Prepare the bundle to upload to Amazon S3 by running the <a href="ami-tools-commands.html#ami-bundle-vol">ec2-bundle-vol</a> command from
                              						your instance. Be sure to specify the <code class="code">-e</code> option to exclude the
                              						directory where your credentials are stored. By default, the bundle process
                              						excludes files that might contain sensitive information. These files include
                              							<code>*.sw</code>, <code>*.swo</code>,
                              							<code>*.swp</code>, <code>*.pem</code>,
                              							<code>*.priv</code>, <code>*id_rsa*</code>,
                              							<code>*id_dsa*</code>
                              						<code>*.gpg</code>, <code>*.jks</code>,
                              							<code>*/.ssh/authorized_keys</code>, and
                              							<code>*/.bash_history</code>. To include all of these files, use
                              						the <code class="code">--no-filter</code> option. To include some of these files, use the
                              							<code class="code">--include</code> option.
                           </p>
                           					
                           <div class="aws-note">
                              <p class="aws-note">Important</p>
                              <p>By default, the AMI bundling process creates a compressed, encrypted
                                 							collection of files in the <code>/tmp</code> directory that
                                 							represents your root volume. If you do not have enough free disk space
                                 							in <code>/tmp</code> to store the bundle, you need to specify a
                                 							different location for the bundle to be stored with the <code class="code">-d
                                    									<em class="replaceable"><code>/path/to/bundle/storage</code></em></code>
                                 							option. Some instances have ephemeral storage mounted at
                                 								<code>/mnt</code> or <code>/media/ephemeral0</code>
                                 							that you can use, or you can also <a href="ebs-creating-volume.html">create</a>, <a href="ebs-attaching-volume.html">attach</a>,
                                 							and <a href="ebs-using-volumes.html">mount</a> a new Amazon EBS volume to
                                 							store the bundle.
                              </p>
                           </div>
                           					
                           <ol>
                              <li>
                                 							
                                 <p>You must run the <b>ec2-bundle-vol</b> command needs
                                    								as root. For most commands, you can use <b>sudo</b> to
                                    								gain elevated permissions, but in this case, you should run
                                    									<b>sudo -E su</b> to keep your environment
                                    								variables.
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>sudo -E su</code></strong></code></pre>
                                 							<p>Note that bash prompt now identifies you as the root user, and
                                    								that the dollar sign has been replaced by a hash tag, signalling
                                    								that you are in a root shell:
                                 </p>
                                 							<pre class="screen">root@ubuntu:#</pre>
                                 						</li>
                              <li><a id="create_bundle_Ubuntu_Linux_step"></a>
                                 							
                                 <p>To create the AMI bundle, run the <a href="ami-tools-commands.html#ami-bundle-vol">ec2-bundle-vol</a> command as follows.
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">root@ubuntu:# </code><strong class="userinput"><code>ec2-bundle-vol -k /tmp/cert/<em class="replaceable"><code>pk-HKZYKTAIG2ECMXYIBH3HXV4ZBEXAMPLE.pem</code></em> -c /tmp/cert/<em class="replaceable"><code>cert-HKZYKTAIG2ECMXYIBH3HXV4ZBEXAMPLE.pem</code></em> -u <em class="replaceable"><code>your_aws_account_id</code></em> -r x86_64 -e /tmp/cert --partition <em class="replaceable"><code>gpt</code></em></code></strong></code></pre>
                                 							<div class="aws-note">
                                    <p class="aws-note">Important</p>
                                    <p>For Ubuntu 14.04 and later HVM instances, add the
                                       										<code class="code">--partition mbr</code> flag to bundle the boot
                                       									instructions properly; otherwise, your newly-created AMI will
                                       									not boot.
                                    </p>
                                 </div>
                                 
                                 							
                                 <p>It can take a few minutes to create the image. When this command
                                    								completes, your <code>tmp</code> directory contains the
                                    								bundle (<code>image.manifest.xml</code>, plus multiple
                                    									<code>image.part.</code><em class="replaceable"><code>xx</code></em>
                                    								files).
                                 </p>
                                 						
                              </li>
                              <li>
                                 							
                                 <p>Exit from the root shell.</p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">root@ubuntu:# </code><strong class="userinput"><code>exit</code></strong></code></pre>
                                 						</li>
                           </ol>
                           				
                        </li>
                        <li>
                           					
                           <p>(Optional) To add more instance store volumes, edit the block device
                              						mappings in the <code>image.manifest.xml</code> file for your AMI.
                              						For more information, see <a href="block-device-mapping-concepts.html">Block Device Mapping</a>.
                           </p>
                           					
                           <ol>
                              <li>
                                 							
                                 <p>Create a backup of your <code>image.manifest.xml</code>
                                    								file.
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>sudo cp /tmp/image.manifest.xml /tmp/image.manifest.xml.bak</code></strong></code></pre>
                                 						</li>
                              <li>
                                 							
                                 <p>Reformat the <code>image.manifest.xml</code> file so that
                                    								it is easier to read and edit.
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>sudo xmllint --format /tmp/image.manifest.xml.bak &gt; /tmp/image.manifest.xml</code></strong></code></pre>
                                 						</li>
                              <li>
                                 							
                                 <p>Edit the block device mappings in
                                    									<code>image.manifest.xml</code> with a text editor. The
                                    								example below shows a new entry for the
                                    									<em class="replaceable"><code>ephemeral1</code></em> instance store
                                    								volume.
                                 </p>
                                 							<pre class="programlisting"><div class="code-btn-container"><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">    &lt;block_device_mapping&gt;
      &lt;mapping&gt;
        &lt;virtual&gt;ami&lt;/virtual&gt;
        &lt;device&gt;sda&lt;/device&gt;
      &lt;/mapping&gt;
      &lt;mapping&gt;
        &lt;virtual&gt;ephemeral0&lt;/virtual&gt;
        &lt;device&gt;sdb&lt;/device&gt;
      &lt;/mapping&gt;
<em class="replaceable"><code>      &lt;mapping&gt;
        &lt;virtual&gt;ephemeral1&lt;/virtual&gt;
        &lt;device&gt;sdc&lt;/device&gt;
      &lt;/mapping&gt;</code></em>
      &lt;mapping&gt;
        &lt;virtual&gt;root&lt;/virtual&gt;
        &lt;device&gt;/dev/sda1&lt;/device&gt;
      &lt;/mapping&gt;
    &lt;/block_device_mapping&gt;</code></pre>
                                 						</li>
                              <li>
                                 							
                                 <p>Save the <code>image.manifest.xml</code> file and exit
                                    								your text editor.
                                 </p>
                                 						
                              </li>
                           </ol>
                           				
                        </li>
                        <li>
                           					
                           <p>To upload your bundle to Amazon S3, run the <a href="ami-tools-commands.html#ami-upload-bundle">ec2-upload-bundle</a> command as follows.
                           </p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>ec2-upload-bundle -b <em class="replaceable"><code>my-s3-bucket</code></em>/<em class="replaceable"><code>bundle_folder</code></em>/<em class="replaceable"><code>bundle_name</code></em> -m /tmp/image.manifest.xml -a <em class="replaceable"><code>your_access_key_id</code></em> -s <em class="replaceable"><code>your_secret_access_key</code></em></code></strong></code></pre>
                           					<div class="aws-note">
                              <p class="aws-note">Important</p>
                              <p>If you intend to register your AMI in a region other than
                                 							US East (N. Virginia), you must specify both the target region with the
                                 								<code class="code">--region</code> option and a bucket path that already exists
                                 							in the target region or a unique bucket path that can be created in the
                                 							target region.
                              </p>
                           </div>
                           				
                        </li>
                        <li>
                           					
                           <p>(Optional) After the bundle is uploaded to Amazon S3, you can remove the bundle
                              						from the <code>/tmp</code> directory on the instance using the
                              						following <b>rm</b> command:
                           </p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>sudo rm /tmp/image.manifest.xml /tmp/image.part.* /tmp/image</code></strong></code></pre>
                           					<div class="aws-note">
                              <p class="aws-note">Important</p>
                              <p>If you specified a path with the <code class="code">-d
                                    									<em class="replaceable"><code>/path/to/bundle/storage</code></em></code> option
                                 							in <a href="create-instance-store-ami.html#step_with_bundle_path_ubuntu">Step 2</a>, use that same path
                                 							below, instead of <code>/tmp</code>.
                              </p>
                           </div>
                           				
                        </li>
                        <li>
                           					
                           <p>To register your AMI, run the <a href="https://docs.aws.amazon.com/cli/latest/reference/ec2/register-image.html" target="_blank">register-image</a> AWS CLI
                              						command as follows.
                           </p>
                           					<pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">ubuntu:~$ </code><strong class="userinput"><code>aws ec2 register-image --image-location <em class="replaceable"><code>my-s3-bucket</code></em>/<em class="replaceable"><code>bundle_folder</code></em>/<em class="replaceable"><code>bundle_name</code></em>/image.manifest.xml --name <em class="replaceable"><code>AMI_name</code></em> --virtualization-type <em class="replaceable"><code>hvm</code></em></code></strong></code></pre>
                           					<div class="aws-note">
                              <p class="aws-note">Important</p>
                              <p>If you previously specified a region for the <a href="ami-tools-commands.html#ami-upload-bundle">ec2-upload-bundle</a>
                                 							command, specify that region again for this command.
                              </p>
                           </div>
                           				
                        </li>
                        <li>
                           					
                           <p>[Ubuntu 14.04 and later] Uncomment the EFI entry in
                              							<code>/etc/fstab</code>; otherwise, your running instance will
                              						not be able to reboot.
                           </p>
                           				
                        </li>
                     </ol>
                     		
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="set-up-ami-tools.html">« Previous </a><a class="awstoc" accesskey="n" href="Using_ConvertingS3toEBS.html">Next »</a></div>
                     <div id="copyright-main-footer">© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Creating an AMI from an Instance&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;Store-Backed Amazon Linux Instance"><a class="pagetoc" href="#amazon_linux_instructions">Creating an AMI from an Instance
                              					Store-Backed Amazon Linux Instance</a></li>
                        <li class="pagetoc" name="Creating an AMI from an Instance Store-Backed&#xA;&#x9;&#x9;&#x9;&#x9;Ubuntu Instance"><a class="pagetoc" href="#ubuntu_instructions">Creating an AMI from an Instance Store-Backed
                              				Ubuntu Instance</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div id="cookie-notice">
         <div class="cookie-notice-text">We use cookies to provide and improve our services. By using our site, you consent
            to cookies. <a href="http://aws.amazon.com/legal/cookies">Learn more</a></div>
      </div>
      <div id="footer">
         <div id="footer_short_fb" class="hide" title="Feedback"><a target="_blank" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=EC2&amp;topic_url=http://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/create-instance-store-ami.html&amp;hidden_guide_name=User Guide for Linux Instances&amp;hidden_api_version=&amp;hidden_file_name=create-instance-store-ami"><i class="awsdocs-footer-text fa fa-envelope-o"></i></a></div>
         <div id="footer_toggle" class="mediaobject">
            <div id="footer_toggle_img" class="awsdocs-footer-text fa fa-caret-down"></div>
            <div id="footer_toggle_img_collapse" class="hide awsdocs-footer-text fa fa-caret-right"></div>
         </div>
         <div id="footer-left"><a class="awsdocs-footer-text" target="_top" href="http://aws.amazon.com/terms">Terms of Use</a><span class="awsdocs-footer-text"> | </span><a class="awsdocs-footer-text" target="_top" href="http://aws.amazon.com/privacy">Privacy</a><span class="awsdocs-footer-text"> | </span><span class="awsdocs-footer-text">© 2018, Amazon Web Services, Inc. or its affiliates. All rights reserved.</span></div>
         <div id="footer-right">
            <div id="feedback">
               <div id="forums"><a id="forum_link" target="_blank" href="http://forums.aws.amazon.com/forum.jspa?forumID=30" class="awsdocs-footer-text">Have a question? Try the Forums.</a></div>
               <div id="feedback-message" class="awsdocs-footer-text">Did this page help you?</div>
               <div id="feedback-yesno-buttons"><a class="awstoc btn btn-default" target="_blank" href="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/create-instance-store-ami.html">Yes</a><a class="awstoc btn btn-default" target="_blank" href="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/create-instance-store-ami.html">No</a></div>
               <div id="feedback-feedback-button"><a class="awstoc btn btn-default" target="_blank" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=EC2&amp;topic_url=http://docs.aws.amazon.com/en_us/AWSEC2/latest/UserGuide/create-instance-store-ami.html&amp;hidden_guide_name=User Guide for Linux Instances&amp;hidden_api_version=&amp;hidden_file_name=create-instance-store-ami">Feedback</a></div>
            </div>
         </div>
      </div>
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon Elastic Compute Cloud';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='User Guide for Linux Instances';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   </body>
</html>